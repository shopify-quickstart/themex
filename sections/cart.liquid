{% comment %}
  Modern, responsive cart section
  https://shopify.dev/docs/storefronts/themes/architecture/templates/cart
{% endcomment %}

<div class="cart-page-container max-w-7xl mx-auto px-4 py-8 lg:py-12">
  {% if cart.item_count > 0 %}
    <div class="flex flex-col lg:flex-row gap-8">
      {%- comment -%} Cart Items - Left Side {%- endcomment -%}
      <div class="flex-1">
        <div class="flex items-center justify-between mb-6">
          <h1 class="text-2xl lg:text-3xl font-bold">{{ 'cart.title' | t }}</h1>
          <span class="text-sm text-gray-600">
            {{- cart.item_count }}
            {% if cart.item_count == 1 %}Item{% else %}Items{% endif -%}
          </span>
        </div>

        <form action="{{ routes.cart_url }}" method="post" id="cart-form">
          <div class="space-y-4">
            {% for item in cart.items %}
              <div class="cart-item bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex gap-4">
                  {%- comment -%} Product Image {%- endcomment -%}
                  <div class="flex-shrink-0">
                    <a
                      href="{{ item.url }}"
                      class="block w-24 h-24 lg:w-32 lg:h-32 overflow-hidden rounded-md bg-gray-100"
                    >
                      {% if item.image %}
                        {% render 'image',
                          image: item.image,
                          alt: item.title,
                          width: '200',
                          height: '200',
                          base_width: '200',
                          class_name: 'w-full h-full object-cover'
                        %}
                      {% else %}
                        <div class="w-full h-full flex items-center justify-center bg-gray-200">
                          <span class="text-gray-400 text-xs">No image</span>
                        </div>
                      {% endif %}
                    </a>
                  </div>

                  {%- comment -%} Product Details {%- endcomment -%}
                  <div class="flex-1 min-w-0">
                    <div class="flex justify-between gap-4">
                      <div class="flex-1">
                        <a
                          href="{{ item.url }}"
                          class="font-medium text-sm lg:text-base hover:text-gray-700 transition-colors line-clamp-2"
                        >
                          {{ item.product.title }}
                        </a>

                        {%- comment -%} Variant Options {%- endcomment -%}
                        {% unless item.product.has_only_default_variant %}
                          <div class="mt-1 text-xs lg:text-sm text-gray-600 space-y-0.5">
                            {% for option in item.options_with_values %}
                              {% unless option.value == 'Default Title' %}
                                <p>
                                  {{ option.name }}: <span class="font-medium">{{ option.value }}</span>
                                </p>
                              {% endunless %}
                            {% endfor %}
                          </div>
                        {% endunless %}

                        {%- comment -%} Properties {%- endcomment -%}
                        {% if item.properties.size > 0 %}
                          <div class="mt-2 text-xs text-gray-600 space-y-0.5">
                            {% for property in item.properties %}
                              {% assign property_first_char = property.first | slice: 0 %}
                              {% unless property.last == blank or property_first_char == '_' %}
                                <p>
                                  {{ property.first }}: <span class="font-medium">{{ property.last }}</span>
                                </p>
                              {% endunless %}
                            {% endfor %}
                          </div>
                        {% endif %}

                        {%- comment -%} Price (Mobile) {%- endcomment -%}
                        <div class="mt-2 lg:hidden">
                          <p class="text-sm font-semibold">{{ item.final_line_price | money }}</p>
                          {% if item.original_line_price > item.final_line_price %}
                            <p class="text-xs text-gray-500 line-through">{{ item.original_line_price | money }}</p>
                          {% endif %}
                        </div>
                      </div>

                      {%- comment -%} Price (Desktop) {%- endcomment -%}
                      <div class="hidden lg:block text-right">
                        <p class="font-semibold">{{ item.final_line_price | money }}</p>
                        {% if item.original_line_price > item.final_line_price %}
                          <p class="text-sm text-gray-500 line-through">{{ item.original_line_price | money }}</p>
                        {% endif %}
                      </div>
                    </div>

                    {%- comment -%} Quantity & Remove {%- endcomment -%}
                    <div class="mt-3 flex items-center justify-between gap-4">
                      <div class="flex items-center border border-gray-300 rounded-md overflow-hidden">
                        <button
                          type="button"
                          class="quantity-decrease px-3 py-2 hover:bg-gray-100 transition-colors"
                          data-line="{{ forloop.index }}"
                          aria-label="Decrease quantity"
                        >
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                          </svg>
                        </button>
                        <input
                          type="number"
                          name="updates[]"
                          id="updates_{{ item.key }}"
                          value="{{ item.quantity }}"
                          min="0"
                          class="quantity-input w-12 text-center border-x border-gray-300 py-2 focus:outline-none focus:ring-2 focus:ring-black pointer-events-none"
                          data-line="{{ forloop.index }}"
                          aria-label="Quantity"
                        >
                        <button
                          type="button"
                          class="quantity-increase px-3 py-2 hover:bg-gray-100 transition-colors"
                          data-line="{{ forloop.index }}"
                          aria-label="Increase quantity"
                        >
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                          </svg>
                        </button>
                      </div>
                      <a
                        href="{{ item.url_to_remove }}"
                        class="text-sm text-red-600 hover:text-red-700 font-medium transition-colors"
                        aria-label="Remove {{ item.title }}"
                      >
                        {{ 'cart.remove' | t }}
                      </a>
                    </div>

                    {%- comment -%} Discounts {%- endcomment -%}
                    {% if item.line_level_discount_allocations.size > 0 %}
                      <div class="mt-2 space-y-1">
                        {% for discount in item.line_level_discount_allocations %}
                          <p class="text-xs text-green-700 bg-green-50 inline-block px-2 py-1 rounded">
                            {{ discount.discount_application.title }} (-{{ discount.amount | money }})
                          </p>
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </form>
      </div>

      {%- comment -%} Order Summary - Right Side {%- endcomment -%}
      <div class="lg:w-96 lg:flex-shrink-0">
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 sticky top-4">
          <h2 class="text-xl font-bold mb-4">Summary</h2>

          <div class="space-y-3 mb-4">
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Subtotal</span>
              <span class="font-medium">{{ cart.total_price | money }}</span>
            </div>

            {% if cart.cart_level_discount_applications.size > 0 %}
              {% for discount in cart.cart_level_discount_applications %}
                <div class="flex justify-between text-sm text-green-700">
                  <span>{{ discount.title }}</span>
                  <span>-{{ discount.total_allocated_amount | money }}</span>
                </div>
              {% endfor %}
            {% endif %}

            {% if cart.taxes_included %}
              <p class="text-xs text-gray-600">Taxes included</p>
            {% else %}
              <p class="text-xs text-gray-600">Taxes excluded</p>
            {% endif %}

            <p class="text-xs text-gray-600">Shipping at checkout</p>
          </div>

          <div class="border-t border-gray-300 pt-4 mb-6">
            <div class="flex justify-between items-center">
              <span class="text-lg font-bold">Total</span>
              <span class="text-2xl font-bold">{{ cart.total_price | money }}</span>
            </div>
          </div>

          <form action="{{ routes.cart_url }}" method="post">
            <button
              type="submit"
              name="checkout"
              class="w-full bg-black text-white py-4 rounded-lg font-semibold hover:bg-gray-900 transition-colors mb-3"
            >
              Checkout
            </button>
          </form>
          <a
            href="{{ routes.all_products_collection_url }}"
            class="block w-full text-center py-3 border border-gray-300 rounded-lg font-medium hover:bg-gray-100 transition-colors"
          >
            Continue Shopping
          </a>
        </div>
      </div>
    </div>

  {% else %}
    {%- comment -%} Empty Cart {%- endcomment -%}
    <div class="text-center py-16">
      <svg class="w-24 h-24 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
      </svg>
      <h1 class="text-2xl font-bold mb-2">Your cart is empty</h1>
      <p class="text-gray-600 mb-6">Your cart is empty. Add items to your cart to get started.</p>
      <a
        href="{{ routes.all_products_collection_url }}"
        class="inline-block px-8 py-3 bg-black text-white rounded-lg font-semibold hover:bg-gray-900 transition-colors"
      >
        Continue Shopping
      </a>
    </div>
  {% endif %}
</div>

<script src="{{ 'cart.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Cart",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_cart_notes",
      "label": "Enable cart notes",
      "default": true
    }
  ]
}
{% endschema %}
